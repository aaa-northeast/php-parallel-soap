name: CI

on:
  push:
    paths:
      - 'src/**'
      - 'tests/**'
      - 'example/**'
      - 'composer.json'
      - 'composer.lock'
    branches:
      - '!*'
      - 'develop'
      - 'stage'
      - 'master'

jobs:
  build-test:
    strategy:
      matrix:
        php: [ 7.2, 7.3, 7.4, 8.0 ]

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          extensions: posix, dom, curl, libxml, mbstring, zip, pcntl, pdo, sqlite, pdo_sqlite, bcmath, soap, intl, gd, exif, iconv, imagick
          coverage: none

      - name: Install dependencies
        run: composer update --prefer-stable --prefer-dist --no-interaction --no-suggest --ignore-platform-reqs

      - name: Test
        run: |
          composer check-style && composer test-cov

# cache:
#  directories:
#    - $HOME/.composer/cache
#
#before_script:
#  - composer self-update
#  - travis_retry composer install-dev
#
#script:
#  - composer check-style
#  # - composer stan todo
#  - composer test-cov
#
#after_script:
#  - |
#    if [[ "$TRAVIS_PHP_VERSION" != 'hhvm' && "$TRAVIS_PHP_VERSION" != '7.0' ]]; then
#      wget https://scrutinizer-ci.com/ocular.phar
#      php ocular.phar code-coverage:upload --format=php-clover coverage.xml
#    fi
#
#after_success:
#  - bash <(curl -s https://codecov.io/bash)
